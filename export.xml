<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25" zv="Cache for UNIX (SUSE Linux Enterprise Server for x86-64) 2014.1.1 (Build 702.1U)" ts="2014-07-10 13:24:06">
<Routine name="CNATest" type="MAC" languagemode="0" timestamp="63378,45386.126429"><![CDATA[
CNATest
    set CNAPath = "/home/dd/Dropbox/is/CNA/libcna.so"
    set testLib = "/home/dd/Dropbox/is/CNA/libsq.so"

    if ##class(%File).Exists(CNAPath) {
        w "libCNA file exists", !
    } else {
        w "Wrong path of libCNA", !
        quit
    }

    if ##class(%File).Exists(testLib) {
        w "Test lib file exists", !
    } else {
        w "Wrong path of test lib", !
        quit
    }

    do $zf(-3, CNAPath)
    w "load CNA", !

    set libID = $zf(-3, "", "load_library", testLib)
    w "load " _ testLib _ " into CNA", !
    
    set func = "sum"
    set argTypes = $CHAR(2, 2, 2, 2, 2, 2)
    set args = $ZLCHAR(12, 10, 35, 321, 21)
    set retVal = $zf(-3, "", "call_function", libID, func, argTypes, args)
    w $ZLASCII(retVal), !
    w "call " _ func _ "() from " _ testLib _ " through CNA", !

    set func = "mul"
    set argTypes = $CHAR(5, 7, 7)
    set args = $ZQCHAR(10) _ $ZDCHAR($DOUBLE(1.5))
    set retVal = $zf(-3, "", "call_function", libID, func, argTypes, args)
    w $ZDASCII(retVal), !
    w "call " _ func _ "() from " _ testLib _ " through CNA", !

    set func = "x"
    set argTypes = $CHAR(5, 5)
    set args = $ZQCHAR(-2384929929829)
    set retVal = $zf(-3, "", "call_function", libID, func, argTypes, args)
    w $ZQASCII(retVal), !
    w "call " _ func _ "() from " _ testLib _ " through CNA", !
    
    set func = "square"
    set argTypes = $CHAR(7, 7)
    set args = $ZDCHAR($DOUBLE(1.2))
    set retVal = $zf(-3, "", "call_function", libID, func, argTypes, args)
    w $ZDASCII(retVal), !
    w "call " _ func _ "() from " _ testLib _ " through CNA", !

    do $zf(-3, "", "free_library", libID)
    w "free " _ testLib _ " from CNA", !

    //w "trying to pass wrong libID to free_library()", !
    //do $zf(-3, "", "free_library", "12rsadasddfq")
    
    do $zf(-3, "")
    w "free CNA", !

]]></Routine>
</Export>
